<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Presensi FUPA â€” Masuk</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#FFC107" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:FILL,GRAD@1,200" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    /* CSS sama seperti yang diberikan */
  </style>
</head>
<body>
  <!-- HTML sama seperti yang diberikan -->

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyApYdiUlLMb9ihBkLnCjDpLJHqYFRFS3Fw",
      authDomain: "fupa-snack.firebaseapp.com",
      projectId: "fupa-snack",
      storageBucket: "fupa-snack.firebasestorage.app",
      messagingSenderId: "972524876738",
      appId: "1:972524876738:web:dd0d57dd8bf2d8a8dd9c5b"
    };

    // Inisialisasi Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // UID roles - sesuai dengan data yang diberikan
    const ADMIN_UIDS = new Set([
      "O1SJ7hYop3UJjDcsA3JqT29aapI3", // karomi@fupa.id
      "uB2XsyM6fXUj493cRlHCqpe2fxH3"  // annisa@fupa.id
    ]);

    const KARYAWAN_UIDS = new Set([
      "7NJ9xoMgQlUbi68CMQWFN5bYvF62", // x@fupa.id
      "Jn7Fghq1fkNGx8f0z8sTGkxH94E2", // cabang1@fupa.id
      "vB3i5h6offMxQslKf2U0J1ElpWS2", // cabang2@fupa.id
      "tIGmvfnqtxf5QJlfPUy9O1uzHJ73", // cabang3@fupa.id
      "zl7xjZaI6BdCLT7Z2WA34oTcFV42", // cabang4@fupa.id
      "NainrtLo3BWRSJKImgIBYNLJEIv2", // cabang5@fupa.id
      "9Y9s8E23TNbMlO9vZBVKQCGGG0Z2", // cabang6@fupa.id
      "dDq2zTPs12Tn2v0Zh4IdObDcD7g2", // cabang7@fupa.id
      "Tkqf05IzI9UTvy4BF0nWtZwbz8j2", // cabang8@fupa.id
      "pMbjHKjsZLWtNHi7PTc8cDJ254w2", // cabang9@fupa.id
      "G0qTjLBc6MeRMPziNTzIT6N32ZM2"  // cabang10@fupa.id
    ]);

    // Util UI
    const $ = (sel) => document.querySelector(sel);
    const toast = (msg) => {
      const t = $("#toast");
      if (!t) return alert(msg);
      t.textContent = msg;
      t.style.display = "block";
      setTimeout(() => { t.style.display = "none"; }, 2200);
    };

    // Redirect berdasarkan role
    function redirectByRole(uid) {
      if (ADMIN_UIDS.has(uid)) {
        return "admin.html";
      } else if (KARYAWAN_UIDS.has(uid)) {
        return "karyawan.html";
      } else {
        auth.signOut();
        return null;
      }
    }

    // UI only: toggle password eye
    document.getElementById('togglePass').onclick = () => {
      const inp = document.getElementById('password');
      const eye = document.getElementById('eye');
      const is = inp.type === 'password';
      inp.type = is ? 'text' : 'password';
      eye.textContent = is ? 'visibility_off' : 'visibility';
    }

    // Login handler
    document.getElementById('loginBtn').onclick = async () => {
      const email = $("#email").value.trim();
      const pass = $("#password").value.trim();
      const loginBtn = $("#loginBtn");
      const loginText = $("#loginText");
      const loginSpinner = $("#loginSpinner");
      const successMessage = $("#successMessage");
      
      if (!email || !pass) { 
        toast("Isi email dan kata sandi."); 
        return; 
      }
      
      try {
        // Tampilkan loading
        loginBtn.disabled = true;
        loginText.textContent = "Memeriksa...";
        loginSpinner.style.display = "inline-block";
        successMessage.style.display = "none";
        
        // Coba login
        const userCredential = await auth.signInWithEmailAndPassword(email, pass);
        const user = userCredential.user;
        
        // Tampilkan pesan sukses
        loginText.textContent = "Berhasil!";
        successMessage.textContent = "Password benar, mengarahkan ke halaman yang sesuai...";
        successMessage.style.display = "block";
        
        // Redirect berdasarkan role
        const redirectPage = redirectByRole(user.uid);
        if (redirectPage) {
          setTimeout(() => {
            window.location.href = redirectPage;
          }, 1500);
        } else {
          toast("Akses ditolak: akun belum diberi peran yang benar.");
          await auth.signOut();
          loginBtn.disabled = false;
          loginText.textContent = "Masuk";
          loginSpinner.style.display = "none";
          successMessage.style.display = "none";
        }
      } catch (e) {
        console.error("Login error:", e);
        loginBtn.disabled = false;
        loginText.textContent = "Masuk";
        loginSpinner.style.display = "none";
        successMessage.style.display = "none";
        
        if (e.code === 'auth/invalid-credential' || e.code === 'auth/wrong-password' || e.code === 'auth/user-not-found') {
          toast("Email atau kata sandi salah.");
        } else {
          toast("Gagal masuk. Periksa koneksi internet Anda.");
        }
      }
    };

    // Handle Enter key press
    document.getElementById('password').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        document.getElementById('loginBtn').click();
      }
    });
  </script>
</body>
</html>